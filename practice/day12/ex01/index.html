<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <!-- 
        1. CRUD -> Persistence(ì˜ì†ì„±) -> JPA. DB -> Storage -> BOM (LocalStorage, SessionStroage)
        2. LLM - ìƒì„±í˜• AI - ì¶”ì²œ ì»¨í…ì¸ , ìš”ì•½, ë²ˆì—­, ... -> í¬í•¨. -> API -> ë„¤íŠ¸ì›Œí¬ ìš”ì²­ (fetch, axios) -> ë¹„ë™ê¸° í”„ë¡œê·¸ë¨
        3. API -> API Key, Data -> ì„ì˜ì ì¸ ìˆ˜ì • Secure ì½”ë”©? -> CORS(Proxy, Whitelist - ì„œë²„ ìì²´ê°€ ì ‘ê·¼ì„ í—ˆìš© -> ì„¤ì¹˜, ì„¤ì •), API Key - ì‚¬ìš©ëŸ‰, ë¹„ìš© -> ë…¸ì¶œ (í•´í‚¹)
        4. íŒŒì¼ ë‹¤ë£¨ê¸° -> WAS, WS -> AWS S3. Free Tier. BaaS / Headless CMS.
        - ê°ì²´ ìŠ¤í† ë¦¬ì§€ -> 1) ì§ì ‘ í´ë¼ìš°ë“œ ì¸ìŠ¤í„´ìŠ¤ì— ì—°ê²° 2) í´ë¼ìš°ë“œì—ì„œ ì œê³µí•˜ëŠ” ë„¤íŠ¸ì›Œí¬ APIë¥¼ ì‚¬ìš©í•´ì„œ ì›ê²©ìœ¼ë¡œ ì „ë‹¬
        => ì—¬í–‰. => 'ì—¬í–‰'ì€ ê±°ë“¤ë¿.
        AI ì‹œëŒ€ ê°œë°œìëŠ” ì–´ëŠ ë°©í–¥ìœ¼ë¡œ ë‚˜ì•„ê°€ì•¼í•˜ëŠ”ê°€? -> ì‹œê°„ì´ ë‚¨ê±°ë‚˜, ë‹¤ì–‘í•œ ê±¸ í•  ê²ƒì´ë‹¤
        -> ë””ìì¸, ì˜ì—…, (<- ì–´ëŠì •ë„ëŠ” ê¸°ì§ˆì  ì˜ì—­) ê¸°íš, ì‚¬ì—…, ...
        ê¸°íš, ì‚¬ì—…. => ì—¬í–‰ => ë¸”ë¡œê·¸? ì§€ë„?
        => ì–´í”Œë¦¬ì¼€ì´ì…˜ ìˆœìœ„ë¥¼ ë³´ê±°ë‚˜, ìš”ìƒˆ ë‰´ìŠ¤ë¥¼ ë³´ê³ . ê±°ê¸°ì— ì´ìŠˆë¥¼ ê°€ì ¸ì˜¨ë‹¤ìŒì— ê·¸ëƒ¥ ì—¬í–‰ì„ ë¶™ì–´ìš”.
        => ê·¸ë¦¬ê³  ìœ„ì— 4ê°€ì§€ë¥¼ ë¶™ì—¬ì„œ ê°œë°œì„ í•´ìš”. ê·¸ëŸ¬ë©´? => í¬íŠ¸í´ë¦¬ì˜¤ê°€ ë¼ìš”.  
        (1) íŠ¸ë Œë“œ, (ì „í˜•ì ì´ì§€ë§Œ ê°•ë ¥í•œ) ì‚¬ëŒì˜ ìš•ë§ì„ ì£¼ì œì— ë¶™ì´ë˜ê°€
        (2) í•˜ëŠ” ê¹€ì— ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ë„ë‹¬í•˜ì§€ ëª»í•œ, í˜¹ì€ ì‚¬ì—…ì„±ì´ ì—†ì–´ì„œë³´ì—¬ì„œ ì‚¬ì´ë“œí”„ë¡œì íŠ¸ë‚˜ ì¸ë”” ê°œë°œì´ ì•„ë‹ˆë©´ ì•ˆí• ë§Œí•œ ê²ƒ. => 5, 6ì¸. => ì§„ì§œ ì¬ë°Œê³  ê´œì°®ì€ ê²ƒ ë‚˜ì˜µë‹ˆë‹¤.
    -->
    <!-- 1ë‹¨ê³„ : (ìë™ ì €ì¥ ì—†ì´) DOM í‘œí˜„í•˜ëŠ” ê°œë… -->
    <!-- <form id="controller">
      <textarea name="textData"></textarea>
      <button>ë“±ë¡</button>
    </form>
    <div id="container"></div>
    <script>
      const container = document.querySelector("#container");
      const form = document.querySelector("#controller");
      // https://ko.javascript.info/proxy
      const data = new Proxy([], {
        // proxy ê°ì²´, í‚¤, ê°’ -> ê°ì²´ì— í‚¤ë¥¼ í†µí•´ì„œ ê°’ì„ ë³€í™˜í•˜ëŠ” ê²ƒì´ ì¼ì–´ë‚˜ë©´ ì¼ë‹¨ ê·¸ê±¸ ì²˜ë¦¬í•˜ê³ 
        // ë°°ì—´ì´ ë“¤ì–´ì˜¤ê²Œ ë˜ë©´, ê·¸ ë°°ì—´ ì „ì²´ê°€ target ë˜ëŠ” ê²ƒ.
        set(target, property, value) {
          target[property] = value; // ...
          updateContainer(); // data ë°°ì—´ì— ë°ì´í„° ì¶”ê°€/ìˆ˜ì • ì‹œ ë°˜ì‘
          return true; // ì„±ê³µ/ì‹¤íŒ¨ true/false.
        },
      });
      function updateContainer() {
        container.innerHTML = ""; // ë°°ì—´ì— ìˆëŠ” ê²ƒì„ ì¼ê´„ ì¶”ê°€í•˜ê¸° ì „ì— ë°€ì–´ë²„ë¦¬ê¸°
        for (const d of data) {
          const tmp = document.createElement("div"); // temp...
          //   tmp.textContent = displayData.text;
          tmp.textContent = d.text;
          container.appendChild(tmp);
        }
      }
      function handleForm(event) {
        event.preventDefault();
        const formData = new FormData(form);
        const displayData = { text: formData.get("textData") };
        console.log(displayData);
        data.push(displayData);
        // ğŸš¨
        // const tmp = document.createElement("div"); // temp...
        // tmp.textContent = displayData.text;
        // container.appendChild(tmp);
      }
      //   form.addEventListener("click", handleForm); // ğŸš¨
      form.addEventListener("submit", handleForm); // formì„ ì“¸ê±°ë©´...
    </script> -->
    <!-- 2ë‹¨ê³„ : ìë™ ì €ì¥ ë° ì‚­ì œ ë²„íŠ¼ -->
    <!-- <header>
      <button id="resetButton">ì €ì¥ëœ ë°ì´í„° ë¦¬ì…‹</button>
    </header>
    <form id="controller">
      <textarea name="textData"></textarea>
      <button>ë“±ë¡</button>
    </form>
    <div id="container"></div>
    <script>
      const container = document.querySelector("#container");
      const form = document.querySelector("#controller");
      // ì €ì¥ëœ ë°ì´í„° ë¦¬ì…‹
      const resetButton = document.querySelector("#resetButton");
      //   resetButton.addEventListener("click", () => localStorage.clear());
      resetButton.addEventListener("click", () => (data.length = 0)); // .clear() ë³„ë„ë¡œ ì—†ì§€ë§Œ... ì´ë ‡ê²Œ í•œë‹µë‹ˆë‹¤ (syntax sugar...)
      //   resetButton.addEventListener("click", resetStorageAndContainer);
      //   function resetStorageAndContainer() {
      //     // localStorage.clear();
      //     // container.innerHTML = ""; // ì´ ë°©ë²•ë„ ìˆê³ ...
      //     // const size = data.length;
      //     // for (let i = 0; i < data.length; i++) { // popì„ í•´ì„œ ë³€í™”í•˜ëŠ” ê°¯ìˆ˜ë§Œí¼ lengthê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¤„ì–´ì„œ ì‹¤í–‰íšŸìˆ˜ê°€ ê°™ì´ ì¤„ì–´ìš”...
      //     // for (let i = 0; i < size; i++) {
      //     //   data.pop();
      //     // }
      //     // while (data.length > 0) {
      //     //   data.pop();
      //     // }
      //   }
      const data = new Proxy([], {
        set(target, property, value) {
          target[property] = value;
          updateContainer();
          //   updateStorage(target, property, value);
          updateStorage(target);
          return true;
        },
      });
      function onMounted() {
        // í•¨ìˆ˜ í˜¸ì´ìŠ¤íŒ…
        // if (data.length === 0) { // if (!data) false ì·¨ê¸‰...
        // }
        // const storageData = localStorage.getItem("myData"); // string | null;
        // const storageDataParsed = JSON.parse(storageData); // nullì´ë©´ ì—¬ì „íˆ null -> objectë‚˜ arrayë¡œ ë³€í™˜ì´ ê°€ëŠ¥í•œ stringì´ë¼ë©´ ë³€í™˜í•´ì£¼ê³  ì•„ë‹ˆë©´...
        // const storageDataParsedSafe = storageDataParsed ?? []; // ë„ ë³‘í•© ì—°ì‚°ì (??) -> ë§Œì•½ì— null, undefined ê°™ì€ ë¹„ì–´ìˆëŠ” ë¥˜ì˜ -> ë‹¤ìŒì˜ ìˆëŠ” í”¼ì—°ì‚°ìë¥¼ ë„£ì–´ë¼
        // data.push(...storageDataParsedSafe);
        data.push(...(JSON.parse(localStorage.getItem("myData")) ?? []));
      }
      onMounted();

      // 1. ìµœì´ˆ í™”ë©´ì´ ë¶ˆëŸ¬ì™€ì¡Œì„ ë•Œì˜ ë¡œë”©.
      // 2. localStorage -> ì§ë ¬í™”/ì—­ì§ë ¬í™”. ë¹„ì—ˆì„ ë•Œ...
      // 3. uuid/seq. -> íŠ¹ì •í•œ ë°ì´í„°ì— ëŒ€í•œ ì§€ì • ì‚­ì œ
      // 4. ì™„ì „ ì‚­ì œ (ë¦¬ì…‹ ë²„íŠ¼)
      function updateContainer() {
        container.innerHTML = "";
        for (const d of data) {
          const tmp = document.createElement("div");
          tmp.textContent = d.text;
          //   console.log(d.id);
          const deleteButton = document.createElement("button");
          deleteButton.textContent = "ì‚­ì œ";
          deleteButton.addEventListener("click", () => {
            const fillterd = data.filter((value) => value.id !== d.id);
            // console.log(fillterd);
            data.length = 0;
            data.push(...fillterd);
          });
          tmp.appendChild(deleteButton);
          container.appendChild(tmp);
        }
      }
      //   function updateStorage(target, property, value) {
      function updateStorage(target) {
        // console.log(target, property, value);
        console.log(target);
        // localStorage.setItem("myData", target); // [object Object]
        localStorage.setItem("myData", JSON.stringify(target)); // ë¬¸ìì—´ë¡œ ì§ë ¬í™”
        console.log(localStorage.getItem("myData"));
      }
      function handleForm(event) {
        event.preventDefault();
        const formData = new FormData(form);
        // uuid(ë²„ì „ì— ë”°ë¼ ê³µí†µ ê·œì¹™ì´ ìˆëŠ”ë° ì›¬ë§Œí•˜ë©´ ì•ˆ ê²¹ì¹¨). seq(1ì”© ì¦ê°€)
        // ìˆœì„œ(ì‹œí€€ìŠ¤), ì‹œê°„, í•´ì‹œ.
        // í•œêµ­ì‹œê°„ì€ UTC+9, KST. Date.now() -> 1970.01.01.00:00:00 ms 0. (UTC+0)
        const displayData = { id: Date.now(), text: formData.get("textData") };
        data.push(displayData);
      }
      form.addEventListener("submit", handleForm);
    </script> -->
    <!-- 3ë‹¨ê³„ : LLM APIë¥¼ ì¨ì„œ ì‘ì„± ë°ì´í„°ì— ëŒ€í•œ ì¶”ì²œì„ ìƒì„±í•˜ê³ , secure coding ì²˜ë¦¬ -->
    <header>
      <button id="resetButton">ì €ì¥ëœ ë°ì´í„° ë¦¬ì…‹</button>
    </header>
    <form id="controller">
      <label>
        ëª¨ë¸ :
        <select name="modelOption">
          <option value="1">gemini-1.5-flash</option>
          <option value="2">deepseek-r1</option>
        </select>
      </label>
      <textarea name="textData"></textarea>
      <button>ë“±ë¡</button>
    </form>
    <div id="container"></div>
    <script>
      const container = document.querySelector("#container");
      const form = document.querySelector("#controller");
      const resetButton = document.querySelector("#resetButton");
      resetButton.addEventListener("click", () => (data.length = 0));
      const data = new Proxy([], {
        set(target, property, value) {
          target[property] = value;
          updateContainer();
          updateStorage(target);
          return true;
        },
      });
      function onMounted() {
        data.push(...(JSON.parse(localStorage.getItem("myData")) ?? []));
      }
      onMounted();

      function updateContainer() {
        container.innerHTML = "";
        for (const d of data) {
          const tmp = document.createElement("div");
          tmp.textContent = d.text;
          const deleteButton = document.createElement("button");
          deleteButton.textContent = "ì‚­ì œ";
          deleteButton.addEventListener("click", () => {
            const fillterd = data.filter((value) => value.id !== d.id);
            data.length = 0;
            data.push(...fillterd);
          });
          // LLM ì‘ë‹µ
          if (d.reply) {
            const box = document.createElement("div");
            const reply = document.createElement("code");
            box.appendChild(reply);
            // CSS in JS, Styled Component
            box.style.padding = "12px";
            box.style.margin = "4px";
            box.style.backgroundColor = "beige";
            box.style.border = "1px solid black";
            reply.textContent = d.reply;
            tmp.appendChild(box);
          }
          tmp.appendChild(deleteButton);
          container.appendChild(tmp);
        }
      }

      function updateStorage(target) {
        // console.log(target);
        localStorage.setItem("myData", JSON.stringify(target));
        // console.log(localStorage.getItem("myData"));
      }
      async function handleForm(event) {
        // awaitë¥¼ ì“°ë ¤ë©´ asyncë¡œ ê°ì‹¸ì ¸ì•„í•¨
        event.preventDefault();
        const formData = new FormData(form);
        // ì´ì¯¤ì—ì„œ ê·¸ëƒ¥ ì¶”ì²œ ë°›ìœ¼ë©´ ì¢‹ì§€ ì•Šì„ê¹Œ?
        const text = formData.get("textData");
        let reply;
        switch (formData.get("modelOption")) {
          case "1":
            reply = `ğŸ‘¬ Gemini : ${await makeReply(text)}`;
            break;
          case "2":
            reply = `ğŸ‘€ DeepSeek : ${await makeReply2(text)}`;
            break;
          default:
            alert("ë¹„ì •ìƒì ì¸ ì ‘ê·¼!");
            throw new Error("ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬!");
            break;
        }
        // const reply = await makeReply(text); // ë„¤íŠ¸ì›Œí¬? ë°ì´í„° í†µì‹ ?
        // const reply = await makeReply2(text); // ëª¨ë¸ êµì²´
        const displayData = {
          id: Date.now(),
          text,
          reply, // ë‹¨ì¶• ë¬¸ë²• ì¤‘ í•˜ë‚˜ (property = keyì˜ ì´ë¦„ê³¼ valueì— ë“¤ì–´ê°€ëŠ” ë³€ìˆ˜ëª…ì´ ê°™ìœ¼ë©´ ë‹¨ì¶• ê°€ëŠ¥)
        };
        data.push(displayData);
      }
      // 1ì°¨ gemini
      async function makeReply(text) {
        // https://aistudio.google.com/
        const GEMINI_API_KEY = "AIzaSyAZNgEdNMCLI5SrHt-us8x10a2H64VqtwI";
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`;
        const response = await fetch(url, {
          method: "POST", // ì†Œì¤‘í•œ í¸ì§€ë¥¼ í’ˆì— ì•ˆê³  ê°€ëŠ” ê²ƒ.
          // fetchëŠ” ë‹¨ìˆœí•œ íˆ´ì´ë¼ì„œ ì§ë ¬í™”ë¥¼ í•´ì¤˜ì•¼í•¨
          body: JSON.stringify({
            contents: [
              {
                parts: [
                  {
                    text: `ë„ˆëŠ” 20ë…„ ê²½ë ¥ì˜ ë©”ë‰´ ì¶”ì²œ ì „ë¬¸ê°€ì•¼. {${text}}ì˜ ë©”ì‹œì§€ë¥¼ ë°”íƒ•ìœ¼ë¡œ, ì ì‹¬ ë©”ë‰´ë¥¼ ì¶”ì²œí•´ì£¼ê³ , 50ì ì´ë‚´ì— í‰ë¬¸ìœ¼ë¡œ ì‘ì„±í•´ì¤˜.`,
                  },
                ], // ìƒëµí•  ìˆ˜ ìˆë‹¤ -> í”„ë¡œí¼í‹° ì´ë¦„ê³¼ ë°¸ë¥˜ ë³€ìˆ˜ì´ë¦„ì´ ê°™ìœ¼ë©´...
              },
            ],
          }),
          headers: {
            "Content-Type": "application/json", // JSON ì‘ë‹µì„ ì£¼ì„¸ìš”
          },
        });
        const json = await response.json(); // JSON.parse
        // console.log(json);
        // return JSON.stringify(json);
        return json.candidates[0].content.parts[0].text;
      }
      // 2ì°¨ deepseek
      async function makeReply2(
        content,
        model = "deepseek-r1-distill-llama-70b"
      ) {
        // deepseek-r1-distill-llama-70b
        /*
        curl -X POST "https://api.groq.com/openai/v1/chat/completions" \
            -H "Authorization: Bearer $GROQ_API_KEY" \
            -H "Content-Type: application/json" \
            -d '{"messages": [{"role": "user", "content": "Explain the importance of fast language models"}], "model": "llama-3.3-70b-versatile"}'
        */
        const GROQ_API_KEY =
          "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";
        const url = "https://api.groq.com/openai/v1/chat/completions";
        const response = await fetch(url, {
          method: "POST", // ì†Œì¤‘í•œ í¸ì§€ë¥¼ í’ˆì— ì•ˆê³  ê°€ëŠ” ê²ƒ.
          // fetchëŠ” ë‹¨ìˆœí•œ íˆ´ì´ë¼ì„œ ì§ë ¬í™”ë¥¼ í•´ì¤˜ì•¼í•¨
          body: JSON.stringify({
            messages: [
              {
                role: "user",
                content: `ë„ˆëŠ” 20ë…„ ê²½ë ¥ì˜ ë©”ë‰´ ì¶”ì²œ ì „ë¬¸ê°€ì•¼. {${content}}ì˜ ë©”ì‹œì§€ë¥¼ ë°”íƒ•ìœ¼ë¡œ, ì ì‹¬ ë©”ë‰´ë¥¼ ì¶”ì²œí•´ì£¼ê³ , 50ì ì´ë‚´ì— í‰ë¬¸ìœ¼ë¡œ ì‘ì„±í•´ì¤˜. ê²°ê³¼ëŠ” í•œê¸€ë¡œ ì‘ì„±í•´ì¤˜.`, // ë‹¨ì¶•ì„ ìœ„í•´ì„œ ê°ê°ì˜ apiê°€ í˜•íƒœì— ë§ì¶°ì„œ
                // ë³€ìˆ˜ëª…ì´ë‚˜ íŒ¨ëŸ¬ë¯¸í„° ëª…ì„ ë°”ê¾¸ëŠ” ê²ƒë„...
              },
            ],
            model,
          }),
          headers: {
            Authorization: `Bearer ${GROQ_API_KEY}`,
            "Content-Type": "application/json", // JSON ì‘ë‹µì„ ì£¼ì„¸ìš”
          },
        });
        const json = await response.json(); // JSON.parse
        // console.log(json);
        // return JSON.stringify(json);
        // return json.choices[0].message.content;
        // split -> íŠ¹ì •í•œ ë¬¸ìíŒ¨í„´ì„ ê¸°ì¤€ìœ¼ë¡œ ë°°ì—´ì„ ë§Œë“¤ì–´ í† í°(ê°œë³„ ì›ì†Œ)í™”
        return json.choices[0].message.content.split("</think>")[1].trim(); // ì•ë’¤ì— ê³µë°±ì„ ì˜ë¼ì¤Œ.
      }
      form.addEventListener("submit", handleForm);
    </script>
  </body>
</html>
